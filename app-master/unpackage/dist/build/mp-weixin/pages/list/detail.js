(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/list/detail"],{"2c6d":function(t,e,n){"use strict";var i=n("3a75"),o=n.n(i);o.a},"3a75":function(t,e,n){},5548:function(t,e,n){"use strict";(function(t,i){var o=n("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=o(n("7eb4")),r=o(n("ee10")),u=t.database(),d=u.collection("read-news-log"),c=u.collection("Videos_record"),l={data:function(){return{quan:0,videobool:0,id:"",title:"title",field:"user_id.nickname,user_id._id,avatar,excerpt,last_modify_date,comment_count,like_count,title,content",formData:{noData:'<p style="text-align:center;color:#666">详情加载中...</p>'},videoFit:"contain",viedoSrc:"",videoInfo:{},pList:"<p>这是一段富文本</p><p>这是二段富文本</p><p>这是三段富文本</p>",currentTime:0,duration:0,startTime:0}},computed:{uniStarterConfig:function(){return getApp().globalData.config},where:function(){return'_id =="'.concat(this.id,'"')}},onUnload:function(t){console.log("页面卸载,查询浏览记录是否存在，存在则更新，不存在则添加"),this.VideosRecord()},onLoad:function(t){t.id&&(this.id=t.id),t.title&&(this.title=t.title,i.setNavigationBarTitle({title:t.title})),this.getVideoInfo(),this.videoOff()},onReady:function(){this.id&&this.$refs.detail.loadData()},onNavigationBarButtonTap:function(t){"share"==t.type&&this.shareClick()},methods:{videoOff:function(){var t=this;i.request({url:"https://fc-mp-f02adfe0-c2b7-4979-95b9-97f95913e417.next.bspapp.com/banner/videoOff"}).then((function(e){t.videobool=e[1].data,t.quan=1}))},VideosRecord:function(){var e=this;return(0,r.default)(a.default.mark((function n(){var i,o,r,u,d,l;return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(0!=e.currentTime){n.next=2;break}return n.abrupt("return");case 2:if(0!=e.duration){n.next=4;break}return n.abrupt("return");case 4:if(i=t.getCurrentUserInfo(),!i.uid){n.next=14;break}return o=i.uid,r=Math.round(e.currentTime/e.duration*100)+"%",u=Math.round(e.currentTime/e.duration*100),d="",n.next=12,c.where({user_id:o,videos_id:e.id}).get().then((function(t){d=t.result.data}));case 12:n.sent,""!=d?d[0].count!=d[0].number&&c.doc(d[0]._id).update({number:e.currentTime,percentage:r,percentage1:u,count:e.duration}):(l={user_id:o,videos_id:e.id,number:e.currentTime,percentage:r,percentage1:u,count:e.duration},c.add(l).then((function(t){console.log(t)})).catch((function(t){console.log(t)})));case 14:case"end":return n.stop()}}),n)})))()},handleTimeUpdate:function(t){var e=t.detail.duration,n=t.detail.currentTime;this.currentTime=n,this.duration=e},getVideoInfo:function(){var t=this;console.log("id是:",this.id),i.request({url:"https://fc-mp-f02adfe0-c2b7-4979-95b9-97f95913e417.next.bspapp.com/push/getVideoById",method:"POST",data:{id:this.id},success:function(e){t.getStrtTime(),console.log("存储前视频信息",e.data.data[0]),t.viedoSrc=e.data.data[0].videofile.url,t.videoInfo=e.data.data[0],console.log("存储后视频信息",t.videoInfo),console.log("详情",t.videoInfo.desc),t.pList=t.videoInfo.desc.split("/").map((function(t){return"<p>".concat(t,"</p>")})).join(""),console.log("pList",t.pList)}})},getStrtTime:function(){var e=this;return(0,r.default)(a.default.mark((function n(){var o,r,u;return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(o=t.getCurrentUserInfo(),!o.uid){n.next=8;break}return r=o.uid,u="",n.next=6,c.where({user_id:r,videos_id:e.id}).get().then((function(t){u=t.result.data}));case 6:n.sent,""!=u&&(e.videoContext=i.createVideoContext("myVideo",e),e.videoContext.seek(u[0].number));case 8:case"end":return n.stop()}}),n)})))()},videoPlay:function(){console.log("视频开始播放")},videoPause:function(){console.log("视频暂停播放")},videoEnded:function(){console.log("视频播放完毕")},$log:function(){for(var t,e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];(t=console).log.apply(t,["args"].concat(n,[this.id]))},setReadNewsLog:function(){var t={article_id:this.id,last_time:Date.now()},e=i.getStorageSync("readNewsLog")||[],n=-1;e.forEach((function(e,i){var o=e.article_id;o==t.article_id&&(n=i)})),-1===n?e.push(t):e.splice(n,1,t),i.setStorageSync("readNewsLog",e),console.log(e)},setFavorite:function(){if(t.getCurrentUserInfo().tokenExpired<Date.now())return console.log("未登录用户");var e=this.id,n=Date.now();console.log({article_id:e,last_time:n}),d.where('"article_id" == "'.concat(e,'" && "user_id"==$env.uid')).update({last_time:n}).then((function(t){var n=t.result.updated;console.log("updated",n),n||d.add({article_id:e}).then((function(t){console.log(t)})).catch((function(t){console.log(t)}))})).catch((function(t){console.log(t)}))},loadData:function(t){""==this.title&&t[0].title&&(this.title=t[0].title,i.setNavigationBarTitle({title:t[0].title})),this.setReadNewsLog()},followClick:function(){i.showToast({title:this.$t("listDetail.follow"),icon:"none"})}}};e.default=l}).call(this,n("861b")["default"],n("df3c")["default"])},c16a:function(t,e,n){"use strict";(function(t,e){var i=n("47a9");n("add7"),n("861b");i(n("3240"));var o=i(n("f41f"));t.__webpack_require_UNI_MP_PLUGIN__=n,e(o.default)}).call(this,n("3223")["default"],n("df3c")["createPage"])},c7fa:function(t,e,n){"use strict";n.r(e);var i=n("5548"),o=n.n(i);for(var a in i)["default"].indexOf(a)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(a);e["default"]=o.a},f41f:function(t,e,n){"use strict";n.r(e);var i=n("fd72"),o=n("c7fa");for(var a in o)["default"].indexOf(a)<0&&function(t){n.d(e,t,(function(){return o[t]}))}(a);n("2c6d");var r=n("828b"),u=Object(r["a"])(o["default"],i["b"],i["c"],!1,null,"38b939a4",null,!1,i["a"],void 0);e["default"]=u.exports},fd72:function(t,e,n){"use strict";n.d(e,"b",(function(){return o})),n.d(e,"c",(function(){return a})),n.d(e,"a",(function(){return i}));var i={uniDateformat:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-dateformat/components/uni-dateformat/uni-dateformat")]).then(n.bind(null,"e7fb"))},unicloudDb:function(){return Promise.all([n.e("common/vendor"),n.e("node-modules/@dcloudio/uni-cli-shared/components/unicloud-db")]).then(n.bind(null,"3220"))},uniList:function(){return n.e("uni_modules/uni-list/components/uni-list/uni-list").then(n.bind(null,"f782"))},uniListItem:function(){return n.e("uni_modules/uni-list/components/uni-list-item/uni-list-item").then(n.bind(null,"215b"))}},o=function(){var t=this,e=t.$createElement,n=(t._self._c,t.$hasSSP("b863f3a6-2")),i=n?!t.$getSSP("b863f3a6-2","default")["loading"]&&t.$getSSP("b863f3a6-2","default")["data"]:null,o=n&&i?t.$getSSP("b863f3a6-2","default"):null,a=t.$getSSP("b863f3a6-2","default")["data"].user_id&&t.$getSSP("b863f3a6-2","default")["data"].user_id[0]&&t.$getSSP("b863f3a6-2","default")["data"].user_id[0].nickname||"未知",r=n&&i?t.$getSSP("b863f3a6-2","default"):null;t.$mp.data=Object.assign({},{$root:{m0:n,m1:i,m2:o,m3:a,m4:r}})},a=[]}},[["c16a","common/runtime","common/vendor"]]]);