(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-list-detail"],{"1c8e":function(e,t,i){var n=i("4f5f");n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);var o=i("967d").default;o("04afa837",n,!0,{sourceMap:!1,shadowMode:!1})},"4f5f":function(e,t,i){var n=i("c86c");t=n(!1),t.push([e.i,"p[data-v-3bd7a6ee]{margin-bottom:16px /* 调整段落间距 */}.article-title[data-v-3bd7a6ee]{padding:20px 15px;font-size:18px;font-weight:700;margin-bottom:10px}.video[data-v-3bd7a6ee]{margin-top:%?50?%;margin:0 15px}.header-content[data-v-3bd7a6ee]{flex:1;display:flex;flex-direction:column;font-size:14px}\n/* 标题 */.uni-title[data-v-3bd7a6ee]{display:flex;margin-bottom:5px;font-size:14px;font-weight:700;color:#3b4144}\n/* 描述 额外文本 */.uni-note[data-v-3bd7a6ee]{color:#999;font-size:12px;\n\ndisplay:flex;\nflex-direction:row;align-items:center}.footer[data-v-3bd7a6ee]{display:flex;align-items:center}.footer-button[data-v-3bd7a6ee]{display:flex;align-items:center;font-size:12px;height:30px;color:#fff;background-color:#ff5a5f}.banner[data-v-3bd7a6ee]{position:relative;margin:0 15px;height:180px;overflow:hidden}.banner-img[data-v-3bd7a6ee]{position:absolute;width:100%}.banner-title[data-v-3bd7a6ee]{display:flex;align-items:center;position:absolute;padding:0 15px;width:100%;bottom:0;height:30px;font-size:14px;color:#fff;background:rgba(0,0,0,.4);overflow:hidden;box-sizing:border-box}.uni-ellipsis[data-v-3bd7a6ee]{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.article-title[data-v-3bd7a6ee]{padding:20px 15px;padding-bottom:0}.article-content[data-v-3bd7a6ee]{padding:15px;font-size:15px;overflow:hidden}",""]),e.exports=t},7607:function(e,t,i){"use strict";var n=i("1c8e"),o=i.n(n);o.a},c7fa:function(e,t,i){"use strict";i.r(t);var n=i("f156"),o=i.n(n);for(var a in n)["default"].indexOf(a)<0&&function(e){i.d(t,e,(function(){return n[e]}))}(a);t["default"]=o.a},e66f:function(e,t,i){"use strict";i.d(t,"b",(function(){return o})),i.d(t,"c",(function(){return a})),i.d(t,"a",(function(){return n}));var n={uniDateformat:i("e7fb").default,unicloudDb:i("3220").default,uniList:i("f782").default,uniListItem:i("215b").default},o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-uni-view",{staticClass:"article"},[i("v-uni-view",{staticClass:"article-title"},[e._v(e._s(e.videoInfo.title))]),i("v-uni-view",{staticClass:"video"},[i("v-uni-video",{ref:"myVideos",staticStyle:{width:"100%",height:"150px"},attrs:{id:"myVideo",src:e.viedoSrc,controls:!0,autoplay:"false"},on:{timeupdate:function(t){arguments[0]=t=e.$handleEvent(t),e.handleTimeUpdate.apply(void 0,arguments)},loadedmetadata:function(t){arguments[0]=t=e.$handleEvent(t),e.handleLoadedMetadata.apply(void 0,arguments)}}})],1),i("v-uni-view",{staticClass:"footer",staticStyle:{"margin-left":"30rpx","margin-top":"20rpx"}},[i("v-uni-view",{staticClass:"uni-note"},[e._v("更新于"),i("uni-dateformat",{attrs:{date:e.videoInfo._creatTime,format:"yyyy-MM-dd hh:mm",threshold:[6e4,2592e6]}})],1)],1),i("v-uni-view",{staticClass:"article-content"},[i("v-uni-rich-text",{attrs:{nodes:e.pList}})],1),i("unicloud-db",{ref:"detail",attrs:{options:e.formData,collection:"opendb-news-articles,uni-id-users",field:e.field,getone:!0,where:e.where,manual:!0,foreignKey:"opendb-news-articles.user_id"},on:{load:function(t){arguments[0]=t=e.$handleEvent(t),e.loadData.apply(void 0,arguments)}},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.data,o=t.loading;t.error,t.options;return[!o&&n?[i("uni-list",{attrs:{border:!1}},[i("uni-list-item",{attrs:{thumbSize:"lg",thumb:n.image},scopedSlots:e._u([{key:"body",fn:function(){return[i("v-uni-view",{staticClass:"header-content"},[i("v-uni-view",{staticClass:"uni-title"},[e._v(e._s(n.user_id&&n.user_id[0]&&n.user_id[0].nickname||"未知"))])],1)]},proxy:!0},{key:"footer",fn:function(){return[i("v-uni-view",{staticClass:"footer"},[i("v-uni-view",{staticClass:"uni-note"},[e._v("更新于"),i("uni-dateformat",{attrs:{date:e.videoInfo._creatTime,format:"yyyy-MM-dd hh:mm",threshold:[6e4,2592e6]}})],1)],1)]},proxy:!0}],null,!0)})],1),i("v-uni-view",{staticClass:"banner"}),i("v-uni-view",{staticClass:"article-content"},[i("v-uni-rich-text",{attrs:{nodes:n.content}})],1)]:e._e()]}}])})],1)},a=[]},f156:function(e,t,i){"use strict";(function(e){i("6a54");var n=i("f5bd").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,i("fd3c"),i("c223"),i("bf0f"),i("2797"),i("aa9c"),i("dd2b");var o=n(i("2634")),a=n(i("2fdc")),r=e.database(),d=r.collection("read-news-log"),s=r.collection("Videos_record"),l={data:function(){return{id:"",title:"title",field:"user_id.nickname,user_id._id,avatar,excerpt,last_modify_date,comment_count,like_count,title,content",formData:{noData:'<p style="text-align:center;color:#666">详情加载中...</p>'},videoFit:"contain",viedoSrc:"",videoInfo:{},pList:"<p>这是一段富文本</p><p>这是二段富文本</p><p>这是三段富文本</p>",currentTime:0,duration:0,startTime:0}},computed:{uniStarterConfig:function(){return getApp().globalData.config},where:function(){return'_id =="'.concat(this.id,'"')}},onUnload:function(e){console.log("页面卸载,查询浏览记录是否存在，存在则更新，不存在则添加"),this.VideosRecord()},onLoad:function(e){e.id&&(this.id=e.id),e.title&&(this.title=e.title,uni.setNavigationBarTitle({title:e.title})),this.getVideoInfo()},onReady:function(){this.id?this.$refs.detail.loadData():uni.showToast({icon:"none",title:this.$t("listDetail.newsErr")})},onNavigationBarButtonTap:function(e){"share"==e.type&&this.shareClick()},methods:{VideosRecord:function(){var t=this;return(0,a.default)((0,o.default)().mark((function i(){var n,a,r,d,l,c;return(0,o.default)().wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(0!=t.currentTime){i.next=2;break}return i.abrupt("return");case 2:if(0!=t.duration){i.next=4;break}return i.abrupt("return");case 4:if(n=e.getCurrentUserInfo(),!n.uid){i.next=14;break}return a=n.uid,r=Math.round(t.currentTime/t.duration*100)+"%",d=Math.round(t.currentTime/t.duration*100),l="",i.next=12,s.where({user_id:a,videos_id:t.id}).get().then((function(e){l=e.result.data}));case 12:i.sent,""!=l?l[0].count!=l[0].number&&s.doc(l[0]._id).update({number:t.currentTime,percentage:r,percentage1:d,count:t.duration}):(c={user_id:a,videos_id:t.id,number:t.currentTime,percentage:r,percentage1:d,count:t.duration},s.add(c).then((function(e){console.log(e)})).catch((function(e){console.log(e)})));case 14:case"end":return i.stop()}}),i)})))()},handleTimeUpdate:function(e){var t=e.detail.duration,i=e.detail.currentTime;this.currentTime=i,this.duration=t},getVideoInfo:function(){var e=this;console.log("id是:",this.id),uni.request({url:"https://fc-mp-f02adfe0-c2b7-4979-95b9-97f95913e417.next.bspapp.com/push/getVideoById",method:"POST",data:{id:this.id},success:function(t){e.getStrtTime(),console.log("存储前视频信息",t.data.data[0]),e.viedoSrc=t.data.data[0].videofile.url,e.videoInfo=t.data.data[0],console.log("存储后视频信息",e.videoInfo),console.log("详情",e.videoInfo.desc),e.pList=e.videoInfo.desc.split("/").map((function(e){return"<p>".concat(e,"</p>")})).join(""),console.log("pList",e.pList)}})},getStrtTime:function(){var t=this;return(0,a.default)((0,o.default)().mark((function i(){var n,a,r;return(0,o.default)().wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(n=e.getCurrentUserInfo(),!n.uid){i.next=8;break}return a=n.uid,r="",i.next=6,s.where({user_id:a,videos_id:t.id}).get().then((function(e){r=e.result.data}));case 6:i.sent,""!=r&&(t.videoContext=uni.createVideoContext("myVideo",t),t.videoContext.seek(r[0].number));case 8:case"end":return i.stop()}}),i)})))()},videoPlay:function(){console.log("视频开始播放")},videoPause:function(){console.log("视频暂停播放")},videoEnded:function(){console.log("视频播放完毕")},$log:function(){for(var e,t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];(e=console).log.apply(e,["args"].concat(i,[this.id]))},setReadNewsLog:function(){var e={article_id:this.id,last_time:Date.now()},t=uni.getStorageSync("readNewsLog")||[],i=-1;t.forEach((function(t,n){var o=t.article_id;o==e.article_id&&(i=n)})),-1===i?t.push(e):t.splice(i,1,e),uni.setStorageSync("readNewsLog",t),console.log(t)},setFavorite:function(){if(e.getCurrentUserInfo().tokenExpired<Date.now())return console.log("未登录用户");var t=this.id,i=Date.now();console.log({article_id:t,last_time:i}),d.where('"article_id" == "'.concat(t,'" && "user_id"==$env.uid')).update({last_time:i}).then((function(e){var i=e.result.updated;console.log("updated",i),i||d.add({article_id:t}).then((function(e){console.log(e)})).catch((function(e){console.log(e)}))})).catch((function(e){console.log(e)}))},loadData:function(e){""==this.title&&e[0].title&&(this.title=e[0].title,uni.setNavigationBarTitle({title:e[0].title})),this.setReadNewsLog()},followClick:function(){uni.showToast({title:this.$t("listDetail.follow"),icon:"none"})}}};t.default=l}).call(this,i("861b")["default"])},f41f:function(e,t,i){"use strict";i.r(t);var n=i("e66f"),o=i("c7fa");for(var a in o)["default"].indexOf(a)<0&&function(e){i.d(t,e,(function(){return o[e]}))}(a);i("7607");var r=i("828b"),d=Object(r["a"])(o["default"],n["b"],n["c"],!1,null,"3bd7a6ee",null,!1,n["a"],void 0);t["default"]=d.exports}}]);